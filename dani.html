<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queen Dani | E-Model V5</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --queen-gold: #ffcf33; --accent: #ff007a; --bg: #030303; --glass: rgba(255, 255, 255, 0.05); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; min-height: 100vh; overflow-x: hidden; }

        /* --- AUTHENTICATION GATE --- */
        #auth-gate { position: fixed; inset: 0; background: #000; z-index: 3000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(20px); }
        .auth-card { background: var(--glass); padding: 40px; border-radius: 24px; border: 1px solid var(--queen-gold); width: 90%; max-width: 420px; text-align: center; box-shadow: 0 0 50px rgba(255,207,51,0.1); }
        .auth-card input { width: 100%; padding: 14px; margin: 8px 0; background: rgba(0,0,0,0.6); border: 1px solid #333; color: #fff; border-radius: 12px; outline: none; }
        .bio-btn { background: none; border: 2px solid var(--queen-gold); color: var(--queen-gold); padding: 14px; border-radius: 12px; cursor: pointer; width: 100%; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }
        .bio-btn:hover { background: var(--queen-gold); color: #000; }

        /* --- SETTINGS SIDEBAR --- */
        #settings-sidebar { position: fixed; right: -350px; top: 0; bottom: 0; width: 320px; background: rgba(10,10,10,0.98); border-left: 1px solid var(--queen-gold); z-index: 2500; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); padding: 40px 25px; }
        #settings-sidebar.open { right: 0; }
        .setting-header { border-bottom: 1px solid #222; margin-bottom: 20px; padding-bottom: 10px; font-weight: 600; color: var(--queen-gold); }
        .setting-group { margin-bottom: 20px; }
        .setting-group label { display: block; font-size: 0.7rem; color: #666; text-transform: uppercase; margin-bottom: 5px; }
        .setting-input { width: 100%; background: #111; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 8px; margin-bottom: 10px; }

        /* --- UI COMPONENTS --- */
        header { padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,215,51,0.1); position: sticky; top:0; background: var(--bg); z-index: 100; }
        .gear-btn { font-size: 1.5rem; cursor: pointer; color: var(--queen-gold); transition: 0.4s; }
        .gear-btn:hover { transform: rotate(90deg); }

        .container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
        .img-preview { width: 100%; height: 280px; border-radius: 20px; overflow: hidden; margin-bottom: 25px; border: 1px solid #222; display: none; }
        .img-preview img { width: 100%; height: 100%; object-fit: cover; }

        .search-box { position: relative; }
        #query { width: 100%; padding: 22px 30px; background: var(--glass); border: 1px solid rgba(255,215,51,0.2); border-radius: 50px; color: #fff; outline: none; font-size: 1.1rem; }
        .search-btn { position: absolute; right: 10px; top: 10px; bottom: 10px; background: var(--queen-gold); border: none; padding: 0 25px; border-radius: 40px; font-weight: 700; cursor: pointer; }

        .card { background: var(--glass); padding: 30px; border-radius: 20px; border-left: 4px solid var(--queen-gold); margin-top: 25px; animation: slideIn 0.5s ease forwards; }
        .lex-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .lex-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; }
        .lex-tag { color: var(--queen-gold); font-size: 0.65rem; text-transform: uppercase; display: block; margin-bottom: 5px; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onclick="wakeAudio()">

    <div id="auth-gate">
        <div class="auth-card">
            <h1 style="color:var(--queen-gold); font-weight:300; margin-bottom:30px;">QUEEN DANI V.5</h1>
            <button class="bio-btn" onclick="runBiometric()">üß¨ SCAN BIOMETRIC</button>
            <div style="margin: 15px 0; color: #333; font-size: 0.7rem;">OR LOGIN / SIGNUP</div>
            <input type="text" id="reg-name" placeholder="Full Name">
            <input type="text" id="reg-user" placeholder="Username">
            <input type="email" id="reg-email" placeholder="Email Address">
            <input type="password" id="reg-pass" placeholder="Password">
            <button onclick="register()" class="search-btn" style="position:static; width:100%; margin-top:10px; padding:15px;">INITIALIZE SESSION</button>
            <p onclick="guestEntry()" style="margin-top:20px; color:#555; cursor:pointer; font-size:0.8rem;">ACCESS AS GUEST üì≥</p>
        </div>
    </div>

    <div id="settings-sidebar">
        <div class="setting-header">CONTROL PANEL</div>
        <div class="setting-group">
            <label>Profile Name</label>
            <input type="text" id="edit-name" class="setting-input" onchange="syncSettings()">
            <label>Username</label>
            <input type="text" id="edit-user" class="setting-input" onchange="syncSettings()">
        </div>
        <div class="setting-group">
            <label>Audio Mode</label>
            <div style="display:flex; align-items:center; gap:10px; font-size:0.8rem;">
                <input type="checkbox" id="tts-toggle" checked onchange="syncSettings()"> Voice Synthesis Active
            </div>
        </div>
        <button onclick="logout()" style="width:100%; padding:12px; background:#441111; color:#ff4444; border:1px solid #ff4444; border-radius:8px; cursor:pointer; margin-top:40px;">LOGOUT</button>
        <button onclick="toggleSettings()" style="width:100%; background:transparent; border:1px solid #333; color:#666; padding:10px; border-radius:8px; margin-top:10px;">CLOSE</button>
    </div>

    <header>
        <div style="display:flex; align-items:center; gap:12px;">
            <div style="width:38px; height:38px; border-radius:50%; background:url('https://files.catbox.moe/61k8fy.jpg') center/cover; border:1.5px solid var(--queen-gold);"></div>
            <div>
                <div id="user-name" style="font-size:0.8rem; font-weight:600; color:var(--queen-gold);">DANI ENGINE</div>
                <div id="user-status" style="font-size:0.5rem; color:#666; letter-spacing:1px;">ONLINE</div>
            </div>
        </div>
        <div class="gear-btn" onclick="toggleSettings()">‚öôÔ∏è</div>
    </header>

    <div class="container">
        <div id="visual-frame" class="img-preview"><img id="ref-image" src=""></div>
        
        <div class="search-box">
            <input type="text" id="query" placeholder="Enter word or encyclopedia topic..." onkeypress="if(event.key==='Enter') queryArchives()">
            <button class="search-btn" onclick="queryArchives()">SEARCH</button>
        </div>

        <div id="output"></div>
    </div>

    <script>
        let currentUser = { name: "Guest", user: "guest01", tts: true };

        function wakeAudio() { window.speechSynthesis.getVoices(); }

        // --- AUTH LOGIC ---
        function runBiometric() {
            const btn = document.querySelector('.bio-btn');
            btn.innerHTML = "üß¨ SCANNING FACE...";
            setTimeout(() => {
                btn.innerHTML = "‚úÖ IDENTITY VERIFIED";
                setTimeout(() => guestEntry(), 600);
            }, 1800);
        }

        function register() {
            const name = document.getElementById('reg-name').value;
            const user = document.getElementById('reg-user').value;
            if(!name || !user) return alert("Please fill fields.");
            currentUser = { name, user, tts: true };
            saveSession();
            launch();
        }

        function guestEntry() {
            currentUser = { name: "Guest", user: "guest_user", tts: true };
            launch();
        }

        function launch() {
            document.getElementById('auth-gate').style.display = 'none';
            document.getElementById('user-name').innerText = currentUser.name.toUpperCase();
            document.getElementById('edit-name').value = currentUser.name;
            document.getElementById('edit-user').value = currentUser.user;
            document.getElementById('tts-toggle').checked = currentUser.tts;
            speak("System initialized. Welcome, " + currentUser.name);
        }

        // --- SETTINGS ---
        function toggleSettings() { document.getElementById('settings-sidebar').classList.toggle('open'); }
        function syncSettings() {
            currentUser.name = document.getElementById('edit-name').value;
            currentUser.user = document.getElementById('edit-user').value;
            currentUser.tts = document.getElementById('tts-toggle').checked;
            document.getElementById('user-name').innerText = currentUser.name.toUpperCase();
            saveSession();
        }
        function saveSession() { localStorage.setItem('dani_v5_session', JSON.stringify(currentUser)); }
        function logout() { localStorage.removeItem('dani_v5_session'); location.reload(); }

        // --- CORE KNOWLEDGE ENGINE ---
        async function queryArchives() {
            const q = document.getElementById('query').value.trim();
            const out = document.getElementById('output');
            const imgFrame = document.getElementById('visual-frame');
            if(!q) return;

            out.innerHTML = "<div class='card'>Consulting Cloud Archives...</div>";

            try {
                // Simultaneous Fetch
                const [dictRes, wikiRes] = await Promise.all([
                    fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${q}`).catch(() => null),
                    fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`).catch(() => null)
                ]);

                out.innerHTML = "";
                let hasData = false;

                // Dictionary Processing
                if(dictRes && dictRes.ok) {
                    hasData = true;
                    const d = await dictRes.json();
                    const entry = d[0].meanings[0];
                    const def = entry.definitions[0].definition;
                    const ex = entry.definitions[0].example || "No usage example recorded.";
                    const syns = entry.synonyms?.slice(0, 3).join(", ") || "None";

                    out.innerHTML += `
                        <div class="card">
                            <span class="lex-tag">Lexical Meaning</span>
                            <h2 style="margin-bottom:10px;">${q.toUpperCase()}</h2>
                            <p style="color:#eee; line-height:1.6;">${def}</p>
                            <div class="lex-grid">
                                <div class="lex-box"><span class="lex-tag">Synonyms</span>${syns}</div>
                                <div class="lex-box"><span class="lex-tag">Example</span>"${ex}"</div>
                            </div>
                        </div>`;
                }

                // Wikipedia Processing
                if(wikiRes && wikiRes.ok) {
                    hasData = true;
                    const w = await wikiRes.json();
                    if(w.originalimage) {
                        document.getElementById('ref-image').src = w.originalimage.source;
                        imgFrame.style.display = 'block';
                    } else { imgFrame.style.display = 'none'; }

                    out.innerHTML += `
                        <div class="card" style="border-left-color:var(--accent);">
                            <span class="lex-tag">Encyclopedia Reference</span>
                            <h2 style="margin-bottom:10px;">${w.title}</h2>
                            <p style="color:#ccc; font-size:0.95rem;">${w.extract}</p>
                        </div>`;
                    
                    if(currentUser.tts) speak(w.extract.substring(0, 180));
                }

                if(!hasData) {
                    out.innerHTML = `<div class="card">The Queen finds no record for "${q}".</div>`;
                    speak("No records found.");
                }

            } catch (err) {
                out.innerHTML = "<div class='card'>Archive Link Failure. Check CORS/Network settings.</div>";
            }
        }

        function speak(text) {
            if(!currentUser.tts) return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            msg.voice = voices.find(v => v.name.includes('Female')) || voices[0];
            msg.pitch = 1.1;
            window.speechSynthesis.speak(msg);
        }

        window.onload = () => {
            const saved = localStorage.getItem('dani_v5_session');
            if(saved) { currentUser = JSON.parse(saved); launch(); }
        }
    </script>
</body>
</html>
